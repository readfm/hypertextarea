<link href='/design/users.css' rel="stylesheet"/>
<div class='app' id='users'>
	<div id='users-list' class='list'>
		<div class="user">
			<div class="user-thumb"></div>

			<div class='user-networks'>
				<a class="i-Gplus" title="Google+" data-service="google"></a>
				<a class="i-FB" title="Facebook" data-service="facebook"></a>
				<a class="i-in" title="LinkedIn" data-service="linkedin"></a>
				<a class="i-twitter" title="Twitter" data-service="twitter"></a>
				<a class="i-pinterest" title="Pinterest" data-service="pinterest"></a>
			</div>

			<h2 class='user-title'>Mantas Kazlauskas</h2>



			<p class='user-desc'>
				Write a short description about yourself. The information you share on this page will only be shown to roperty owners and real estate agents if you show your explicit interest in their properties.
			</p>

			<div class='user-details'>
				<span class="user-phone">+37063092504</span>
				<span class="user-email">mntask@gmail.com</span>
			</div>
		</div>
	</div>

	<footer id='filters'>
		<input id='users-search' placeholder='Search for users'/>
	</footer>
</div>

<script>
$(function(){
	var Users = window.Site.apps.users = window.Users = {
		build: function(d, $user){
			if(!$user) $user = Users.$user.clone();
			if(!d) return;

			$user.data(d);

			$user.find('.user-title').text(d.name || d.fullName || '');
			$user.find('.user-desc').text(d.desccription || '');


			$user.find('.user-phone').text(d.phone).showIf(d.phone);
			$user.find('.user-email').text(d.email).showIf(d.email);

			if(d.thumb)
				$user.find('.user-thumb').css({
					'background-image': 'url(/thumb/'+d.thumb+')',
				});

			var $nets = $user.find('.user-networks').empty();
			if(d.networks)
				_.each(d.networks, function(profile, service){
					var $net = Users.buildNetwork(profile, service);
					$nets.append($net);
				});

			return $user;
		},
		
		buildNetwork: function(profile, type){
			var button = document.createElement('a'),
				className = 'i-'+type;
			button.classList.add(className);

			var link = profile.link;
			if(type == 'linkedin') link = profile.siteStandardProfileRequest.url;
			if(type == 'twitter') link = 'https://twitter.com/'+profile.screen_name;
			button.onclick = function(){
				window.open(link, '_blank');
				return false;
			}
			return button;
		},

		$items: {},

		open: function(){
			Users.load();
		},

		load: function(f, cb){
			var $list = $('#users-list');

			if(!f) f = {};
			if(!f.filter) f.filter = {};

			$list.data(f);
			Users.f = f;

			if(!f.skip)
				$list.empty();

			ws.send({
				cmd: 'load',
				filter: {},
				collection: 'users'
			}, function(r){
				(r.items || []).forEach(function(item){
					var $item = Users.build(item);
					$list.append($item);
				});
			});
		},
	}

	var $user = $('#users-list > .user');
	Users.$user = $user.clone();
	$user.remove();

	$('#users-list').on('click', '.user-title', function(){
		var user = $(this).parent().data();

		ViewUser.loadInfo(user);
	});
});
</script>